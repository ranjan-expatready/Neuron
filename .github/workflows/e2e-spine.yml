name: E2E Spine (TC000)

on:
  workflow_dispatch:
    inputs:
      frontend-url:
        description: "Frontend base URL (defaults to http://localhost:3000)"
        required: false
        default: "http://localhost:3000"
      notes:
        description: "Optional comment for this run"
        required: false

jobs:
  e2e-spine:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install backend dependencies
        working-directory: ./backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Prepare sqlite e2e database
        working-directory: ./backend
        run: |
          python -m venv .venv
          source .venv/bin/activate
          make e2e-db-reset

      - name: Document remaining manual steps
        run: |
          echo "Backend sqlite e2e.db prepared."
          echo "To run TC000 headlessly in CI:"
          echo "1. Launch backend with DATABASE_URL=sqlite:///./backend/e2e.db uvicorn src.app.main:app --host 0.0.0.0 --port 8000"
          echo "2. Launch frontend via npm run dev (make sure it matches the frontend-url input)."
          echo "3. Execute: TESTSPRITE_UI_BASE_URL=${{ github.event.inputs.frontend-url }} backend/.venv/bin/python testsprite_tests/TC000_Full_User_Journey.py"
          echo ""
          echo "Until we have deterministic browser/preview servers in CI, this workflow seeds the DB and instructs engineers on final TC000 execution."
